---
title: "Using gratia for plotting"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using gratia for plotting}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette demonstrates XXX.

The data we will use here contains tract profiles from diffusion MRI
measurements in a group of patients with Amyotrophic Lateral Sclerosis (ALS)
and a group of matched controls [@Sarica2017].

We start by loading the `tractr` library:

```{r setup}
library(tractr)
library(gratia)
library(ggplot2)
```

Next, we will use a function that is included in `tractr` to read this dataset
directly into memory. Importantly, both the group ("ALS" or "CTRL") and the
subject identifier ("subjectID") need to be factors for subsequent analysis
to work properly.

```{r}
sarica <- tractr::read.afq.sarica()
sarica$group <- factor(sarica$class)
sarica$subjectID <- unclass(factor(sarica$subjectID))
```


```{r}
gam_fit_4 <- tractr_single_bundle(df_afq = sarica,
                                    tract = "Right Corticospinal",
                                    participant_id = "subjectID",
                                    group_by = "group",
                                    covariates = c("age", "group"),
                                    dwi_metric = "fa",
                                    k = 4)
```

```{r}
gam_fit_8 <- tractr_single_bundle(df_afq = sarica,
                                    tract = "Right Corticospinal",
                                    participant_id = "subjectID",
                                    group_by = "group",
                                    covariates = c("age", "group"),
                                    dwi_metric = "fa",
                                    k = 8)
```


```{r}
gam_fit_16 <- tractr_single_bundle(df_afq = sarica,
                                    tract = "Right Corticospinal",
                                    participant_id = "subjectID",
                                    group_by = "group",
                                    covariates = c("age", "group"),
                                    dwi_metric = "fa",
                                    k = 16)
```


```{r}
sm_4 <- smooth_estimates(gam_fit_4) %>%
  gratia::add_confint()

p_sm_4 <- sm_4 %>%
      ggplot() +
      geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, x = nodeID),
                  alpha = 0.2) +
      geom_line(aes(x = nodeID, y = est))+
  labs(y = "FA", title = "k=4")
p_sm_4
```

```{r}
sm_8 <- smooth_estimates(gam_fit_8) %>%
  gratia::add_confint()

p_sm_8 <- sm_8 %>%
      ggplot() +
      geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, x = nodeID),
                  alpha = 0.2) +
      geom_line(aes(x = nodeID, y = est)) +
  labs(y = "FA", title = "k=8")

p_sm_8
```

```{r}
sm_16 <- smooth_estimates(gam_fit_16) %>%
  gratia::add_confint()

p_sm_16 <- sm_16 %>%
      ggplot() +
      geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, x = nodeID),
                  alpha = 0.2) +
      geom_line(aes(x = nodeID, y = est))+
  labs(y = "FA", title = "k=16")
p_sm_16
```


## References
